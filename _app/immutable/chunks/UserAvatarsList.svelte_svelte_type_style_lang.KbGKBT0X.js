import{f as d,m as c,d as m,a,b as s,S as u,h as f}from"./Stack.svelte_svelte_type_style_lang.CUA6CrGc.js";const l=e=>"telegramId"in e;function i(e){const t={id:0,userName:""};return l(e)&&(t.id=e.telegramId,t.userName=e.telegramName),{telegram:t,eventId:e.eventId,meta:{id:e.userId,description:e.userInfo,userName:e.userName||"",photoLink:e.photoLink||void 0}}}function U(e){return{userId:e.meta.id,eventId:e.eventId,userName:e.meta.userName,userInfo:e.meta.description,photoLink:e.meta.photoLink||null}}const h=d(m,"USER_REGISTERED").pipe(c(i)),I=d(m,"USER_UPDATED").pipe(c(i));function x(e){return a.get(`/users/${e}`).then(t=>t.data).then(t=>t.map(i))}function $(e){return a.post(`/form/${e.eventId}/${e.meta.id}`,U(e)).then(t=>t.data).then(i)}function F(e,t){return a.get(`/form/${e}/${t}`).then(n=>n.data).then(i).then(n=>n.meta.userName?n:null).catch(()=>null)}function _(e,t){return a.post("/meeting/get_user_for_fast_meeting",{userId:Number(t),eventId:Number(e)}).then(n=>!!n.data)}function E(e,t){return a.get(`/meeting/is_fast_meeting_exist/${e}/${t}`).then(n=>n.data)}function v(e,t){return a.get(`/meeting/cancel_fast_meeting/${e}/${t}`)}s(({eventId:e,userId:t})=>F(e,t));const N=s(x),S=s($),D=s(({eventId:e,userId:t})=>E(e,t)),A=s(({eventId:e,userId:t})=>_(e,t)),M=s(({eventId:e,userId:t})=>v(e,t)),R=u(I),k=u(h),r=e=>`${e.eventId}~${e.meta.id}`;function g(e,t){return e.findIndex(n=>r(n)===r(t))}function b(e,t){const n=new Set(e.map(r));return t.filter(p=>!n.has(r(p)))}function o(e,t){const n=g(e,t);return n!==-1?(e[n]=t,[...e]):e}function L(e,t){const n=g(e,t);return n!==-1?(e[n]=t,[...e]):[...e,t]}const y=f([],{name:"users"}).on(N.doneData,(e,t)=>e.concat(b(e,t))).on(k,L).on(S.doneData,o).on(R,o),B=f(!1).on(M.doneData,()=>!1).on(A.doneData,(e,t)=>!t).on(D.doneData,(e,t)=>t);export{S as a,B as b,M as c,h as d,I as e,x as f,N as g,$ as h,D as i,F as j,_ as k,E as l,v as m,A as s,y as u};
