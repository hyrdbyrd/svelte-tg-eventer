import{f as a,m as p,a as o,b as i,S as u,d,e as c}from"./Stack.svelte_svelte_type_style_lang.q35J2cnn.js";import"./entry.D8NMrKOt.js";const f=e=>"telegramId"in e;function s(e){const t={id:0,userName:""};return f(e)&&(t.id=e.telegramId,t.userName=e.telegramName),{telegram:t,eventId:e.eventId,meta:{id:e.userId,userName:e.userName,description:e.userInfo,photoLink:e.photoLink||void 0}}}function I(e){return{userId:e.meta.id,eventId:e.eventId,userName:e.meta.userName,userInfo:e.meta.description,photoLink:e.meta.photoLink||null}}a(o,"open");a(o,"error");a(o,"USER_REGISTERED");const U=a(o,"USER_UPDATED").pipe(p(s));function g(e){return i.get(`/users/${e}`).then(t=>t.data).then(t=>t.map(s))}function l(e){return i.post(`/form/${e.eventId}/${e.meta.id}`,I(e)).then(t=>t.data).then(s)}function h(e,t){return i.get(`/form/${e}/${t}`).then(n=>n.data).then(s)}function _(e,t){return i.post("/meeting/get_user_for_fast_meeting",{userId:Number(t),eventId:Number(e)})}const v=u(U),b=d(({eventId:e,userId:t})=>h(e,t)),E=d(g),A=d(l),r=e=>`${e.eventId}~${e.meta.id}`;function N(e,t){return e.findIndex(n=>r(n)===r(t))}function x(e,t){const n=new Set(e.map(r));return t.filter(m=>!n.has(r(m)))}const F=c([]).on(E.doneData,(e,t)=>e.concat(x(e,t))).on(v,(e,t)=>{const n=N(e,t);return n!==-1?(e[n]=t,[...e]):e});export{F as a,b,E as g,_ as s,A as u};
