import{f as d,m,d as u,a as s,b as o,S as c,h as f}from"./Stack.svelte_svelte_type_style_lang.B-WVvGPi.js";const g=e=>"telegramId"in e;function a(e){const t={id:0,userName:""};return g(e)&&(t.id=e.telegramId,t.userName=e.telegramName),{telegram:t,eventId:e.eventId,meta:{id:e.userId,description:e.userInfo,userName:e.userName||"",photoLink:e.photoLink||void 0}}}function l(e){return{userId:e.meta.id,eventId:e.eventId,userName:e.meta.userName,userInfo:e.meta.description,photoLink:e.meta.photoLink||null}}const I=d(u,"USER_REGISTERED").pipe(m(a)),U=d(u,"USER_UPDATED").pipe(m(a));function h(e){return s.get(`/users/${e}`).then(t=>t.data).then(t=>t.map(a))}function v(e){return s.post(`/form/${e.eventId}/${e.meta.id}`,l(e)).then(t=>t.data).then(a)}function N(e,t){return s.get(`/form/${e}/${t}`).then(n=>n.data).then(a).then(n=>n.meta.userName?n:null).catch(()=>null)}function D(e,t){return s.post("/meeting/get_user_for_fast_meeting",{userId:Number(t),eventId:Number(e)})}o(({eventId:e,userId:t})=>N(e,t));const $=o(h),E=o(v),S=c(U),x=c(I),r=e=>`${e.eventId}~${e.meta.id}`;function R(e,t){return e.findIndex(n=>r(n)===r(t))}function _(e,t){const n=new Set(e.map(r));return t.filter(p=>!n.has(r(p)))}function i(e,t){const n=R(e,t);return n!==-1?(e[n]=t,[...e]):e}const b=f([],{name:"users"}).on($.doneData,(e,t)=>e.concat(_(e,t))).on(x,(e,t)=>[...e,t]).on(E.doneData,i).on(S,i);export{E as a,I as b,U as c,h as d,v as e,N as f,$ as g,D as s,b as u};
